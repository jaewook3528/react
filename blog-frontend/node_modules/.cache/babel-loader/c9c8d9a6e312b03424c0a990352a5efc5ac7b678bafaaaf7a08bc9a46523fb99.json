{"ast":null,"code":"var _jsxFileName = \"C:\\\\react\\\\git\\\\react\\\\blog-frontend\\\\src\\\\containers\\\\posts\\\\PostListContainer.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport qs from 'qs';\nimport { withRouter } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PostList from '../../components/posts/PostList';\nimport { listPosts } from '../../modules/posts';\nconst PostListContainer = _ref => {\n  _s();\n  let {\n    location\n  } = _ref;\n  const dispatch = useDispatch();\n  const {\n    posts,\n    error,\n    loading,\n    user,\n    hasMorePosts\n  } = useSelector(_ref2 => {\n    let {\n      posts,\n      loading,\n      user\n    } = _ref2;\n    return {\n      posts: posts.posts,\n      error: posts.error,\n      loading: loading['posts/LIST_POSTS'],\n      user: user.user,\n      hasMorePosts: posts.hasMorePosts\n    };\n  });\n  const postListRef = useRef(null);\n  useEffect(() => {\n    const {\n      tag,\n      username,\n      page\n    } = qs.parse(location.search, {\n      ignoreQueryPrefix: true\n    });\n    dispatch(listPosts({\n      tag,\n      username,\n      page\n    }));\n  }, [dispatch, location.search]);\n  useEffect(() => {\n    const postListElement = postListRef.current;\n    if (!postListElement) return;\n    const handleScroll = () => {\n      if (postListElement.scrollTop + postListElement.clientHeight >= postListElement.scrollHeight) {\n        if (!loading && hasMorePosts) {\n          const nextPage = Math.floor(posts.length / 10) + 1;\n          const {\n            tag,\n            username\n          } = qs.parse(location.search, {\n            ignoreQueryPrefix: true\n          });\n          dispatch(listPosts({\n            tag,\n            username,\n            page: nextPage\n          }));\n        }\n      }\n    };\n    postListElement.addEventListener('scroll', handleScroll);\n    return () => {\n      postListElement.removeEventListener('scroll', handleScroll);\n    };\n  }, [dispatch, location.search, hasMorePosts, loading, posts.length]);\n  return /*#__PURE__*/React.createElement(PostList, {\n    loading: loading,\n    error: error,\n    posts: posts,\n    showWriteButton: user,\n    ref: postListRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 5\n    }\n  });\n};\n_s(PostListContainer, \"D3wxwvDaJ/XWM+YxbIc1bA9Fyp8=\", false, function () {\n  return [useDispatch, useSelector];\n});\n_c = PostListContainer;\nexport default _c2 = withRouter(PostListContainer);\nvar _c, _c2;\n$RefreshReg$(_c, \"PostListContainer\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"names":["React","useEffect","useRef","qs","withRouter","useDispatch","useSelector","PostList","listPosts","PostListContainer","_ref","_s","location","dispatch","posts","error","loading","user","hasMorePosts","_ref2","postListRef","tag","username","page","parse","search","ignoreQueryPrefix","postListElement","current","handleScroll","scrollTop","clientHeight","scrollHeight","nextPage","Math","floor","length","addEventListener","removeEventListener","createElement","showWriteButton","ref","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","_c","_c2","$RefreshReg$"],"sources":["C:/react/git/react/blog-frontend/src/containers/posts/PostListContainer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport qs from 'qs';\r\nimport { withRouter } from 'react-router-dom';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport PostList from '../../components/posts/PostList';\r\nimport { listPosts } from '../../modules/posts';\r\n\r\nconst PostListContainer = ({ location }) => {\r\n  const dispatch = useDispatch();\r\n  const { posts, error, loading, user, hasMorePosts } = useSelector(\r\n    ({ posts, loading, user }) => ({\r\n      posts: posts.posts,\r\n      error: posts.error,\r\n      loading: loading['posts/LIST_POSTS'],\r\n      user: user.user,\r\n      hasMorePosts: posts.hasMorePosts,\r\n    }),\r\n  );\r\n\r\n  const postListRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const { tag, username, page } = qs.parse(location.search, {\r\n      ignoreQueryPrefix: true,\r\n    });\r\n    dispatch(listPosts({ tag, username, page }));\r\n  }, [dispatch, location.search]);\r\n\r\n  useEffect(() => {\r\n    const postListElement = postListRef.current;\r\n    if (!postListElement) return;\r\n\r\n    const handleScroll = () => {\r\n      if (postListElement.scrollTop + postListElement.clientHeight >= postListElement.scrollHeight) {\r\n        if (!loading && hasMorePosts) {\r\n          const nextPage = Math.floor(posts.length / 10) + 1;\r\n          const { tag, username } = qs.parse(location.search, {\r\n            ignoreQueryPrefix: true,\r\n          });\r\n          dispatch(listPosts({ tag, username, page: nextPage }));\r\n        }\r\n      }\r\n    };\r\n\r\n    postListElement.addEventListener('scroll', handleScroll);\r\n\r\n    return () => {\r\n      postListElement.removeEventListener('scroll', handleScroll);\r\n    };\r\n  }, [dispatch, location.search, hasMorePosts, loading, posts.length]);\r\n\r\n  return (\r\n    <PostList\r\n      loading={loading}\r\n      error={error}\r\n      posts={posts}\r\n      showWriteButton={user}\r\n      ref={postListRef}\r\n    />\r\n  );\r\n};\r\n\r\nexport default withRouter(PostListContainer);"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}